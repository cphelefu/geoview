/*! Package:geoview-layers-panel: 0.1.0 - "9b63260df8051f439c1669fbd3cd666d60960f82" - 2024-03-27T14:59:30.072Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[617],{18755:(e,t,n)=>{n.d(t,{G:()=>s});var r=n(80669),a=n(23133),i=n(73963),o=n(78330),s=function(){function e(t,n){(0,r.A)(this,e),(0,i.A)(this,"pluginId",void 0),(0,i.A)(this,"pluginProps",void 0),(0,i.A)(this,"configObj",void 0),(0,i.A)(this,"api",void 0),(0,i.A)(this,"react",void 0),(0,i.A)(this,"translate",void 0),(0,i.A)(this,"useTheme",void 0),this.pluginId=t,this.pluginProps=n}return(0,a.A)(e,[{key:"map",value:function(){var e;return null===(e=this.api)||void 0===e?void 0:e.maps[this.pluginProps.mapId]}},{key:"displayLanguage",value:function(){var e;return(null===(e=this.translate)||void 0===e?void 0:e.getI18n().language)||"en"}},{key:"added",value:function(){var e;window.cgpv&&(o.vF.logInfo("Plugin ".concat(this.pluginId," loaded, adding it on map ").concat(this.pluginProps.mapId)),this.onAdd(),null===(e=this.onAdded)||void 0===e||e.call(this),o.vF.logInfo("Plugin ".concat(this.pluginId," loaded, and added to map ").concat(this.pluginProps.mapId)))}},{key:"removed",value:function(){var e;window.cgpv&&(o.vF.logInfo("Plugin ".concat(this.pluginId," being removed from map ").concat(this.pluginProps.mapId)),this.onRemove(),null===(e=this.onRemoved)||void 0===e||e.call(this),o.vF.logInfo("Plugin ".concat(this.pluginId," removed from map ").concat(this.pluginProps.mapId)))}}]),e}()},7493:(e,t,n)=>{n.d(t,{i:()=>d});var r=n(80669),a=n(23133),i=n(82734),o=n(59290),s=n(17089),l=n(99317),c=n(73963);function u(e,t,n){return t=(0,o.A)(t),(0,i.A)(e,p()?Reflect.construct(t,n||[],(0,o.A)(e).constructor):t.apply(e,n))}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(p=function(){return!!e})()}var d=function(e){function t(){var e;(0,r.A)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e=u(this,t,[].concat(a)),(0,c.A)((0,s.A)(e),"buttonPanel",void 0),(0,c.A)((0,s.A)(e),"buttonProps",void 0),(0,c.A)((0,s.A)(e),"panelProps",void 0),e}return(0,l.A)(t,e),(0,a.A)(t,[{key:"onCreateButtonProps",value:function(){var e=window.cgpv.ui.elements.MapIcon;return{id:"somePluginButton",tooltip:"Some tooltip",tooltipPlacement:"right",children:this.react.createElement(e),visible:!0}}},{key:"onCreateContentProps",value:function(){var e;return{title:"Some title",icon:'<i class="material-icons">map</i>',width:"80vw",status:null===(e=this.configObj)||void 0===e?void 0:e.isOpen}}},{key:"onCreateContent",value:function(){return this.react.createElement("div",void 0,"Content for AppBar Plugin on map id ".concat(this.pluginProps.mapId," goes here..."))}},{key:"onAdd",value:function(){var e;this.buttonProps=this.onCreateButtonProps(),this.panelProps=this.onCreateContentProps(),this.panelProps.content=this.onCreateContent(),this.buttonPanel=(null===(e=this.map())||void 0===e?void 0:e.appBarApi.createAppbarPanel(this.buttonProps,this.panelProps,null))||void 0}},{key:"onRemove",value:function(){var e;this.api&&this.buttonPanel&&(null===(e=this.map())||void 0===e||e.appBarApi.removeAppbarPanel(this.buttonPanel.buttonPanelId))}}]),t}(n(18755).G)},97617:(e,t,n)=>{var r=n(80669),a=n(23133),i=n(82734),o=n(59290),s=n(17089),l=n(99317),c=n(73963),u=n(73943),p=n(7493),d=n(9613),f=n(66748),h=n(40048),v=n(78330),g=n(92363),y=n(64316),x=n.n(y),m=n(80678);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,c.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const j=function(e){var t=e.mapId,n=e.setAddLayerVisible,r=window.cgpv,a=r.api,i=r.ui,o=r.react,s=a.maps[t].getDisplayLanguage(),l=a.layerTypes,c=l.ESRI_DYNAMIC,u=l.ESRI_FEATURE,p=l.GEOJSON,d=l.GEOPACKAGE,f=l.WMS,y=l.WFS,b=l.OGC_FEATURE,j=l.XYZ_TILES,E=l.GEOCORE,P=o.useState,I=o.useRef,C=i.elements,w=C.Select,L=C.Stepper,O=C.TextField,S=C.Button,k=C.ButtonGroup,N=C.Autocomplete,T=C.CircularProgressBase,D=C.Box,R=C.IconButton,U=C.CloseIcon,F=C.FileUploadIcon,G=P(0),M=(0,h.A)(G,2),W=M[0],B=M[1],_=P(""),V=(0,h.A)(_,2),z=V[0],Y=V[1],J=P(""),K=(0,h.A)(J,2),X=K[0],Z=K[1],H=P(""),q=(0,h.A)(H,2),Q=q[0],$=q[1],ee=P([]),te=(0,h.A)(ee,2),ne=te[0],re=te[1],ae=P(""),ie=(0,h.A)(ae,2),oe=ie[0],se=ie[1],le=P([]),ce=(0,h.A)(le,2),ue=ce[0],pe=ce[1],de=P(!1),fe=(0,h.A)(de,2),he=fe[0],ve=fe[1],ge=P(!1),ye=(0,h.A)(ge,2),xe=ye[0],me=ye[1],be=I(null),Ae={buttonGroup:{paddingTop:12,gap:6}},je=function(){return Q===c||Q===y||Q===f},Ee=[[c,"ESRI Dynamic Service"],[u,"ESRI Feature Service"],[p,"GeoJSON"],[d,"GeoPackage"],[f,"OGC Web Map Service (WMS)"],[y,"OGC Web Feature Service (WFS)"],[b,"OGC API Features"],[j,"XYZ Raster Tiles"],[E,"GeoCore"]],Pe={en:{finish:"Finish",continue:"Continue",back:"Back",or:"or",dropzone:"Drop Here",upload:"Choose a File",drop:"Drop the file to upload",url:"Enter URL or UUID",layer:"Layer",stepOne:"Upload a File or enter URL/UUID",stepTwo:"Select format",stepThree:"Configure layer",stepFour:"Enter Name",service:"Service Type",name:"Name",layerSelect:"Select Layer",errorEmpty:"cannot be empty",errorNone:"No file or source added",errorFile:"Only geoJSON and GeoPackage files can be used",errorServer:"source is not valid",errorProj:"does not support current map projection",only:"only"},fr:{finish:"Finir",continue:"Continuer",back:"Retour",or:"ou",dropzone:"Déposez ici",upload:"Choisir un fichier",drop:"Déposez le fichier à télécharger",url:"Entrer l'URL ou l'UUID",layer:"Couche",stepOne:"Ajouter un fichier ou entrer l'URL/UUID",stepTwo:"Sélectionnez le format",stepThree:"Configurer la couche",stepFour:"Entrez le nom",service:"Type de service",name:"Nom",layerSelect:"Sélectionner la couche",errorEmpty:"ne peut être vide",errorNone:"Pas de fichier ou de source ajouté",errorFile:"Seuls les fichiers geoJSON et GeoPackage peuvent être utilisés",errorServer:"source n'est pas valide",errorProj:"ne prend pas en charge la projection cartographique actuelle",only:"seulement"}},Ie=function(e){switch(e){case c:return{err:"ESRI Map",capability:"Map"};case u:return{err:"ESRI Feature",capability:"Query"};default:return{err:"",capability:""}}},Ce=function(e){ve(!1),a.utilities.showError(t,"".concat(e," ").concat(Pe[s].errorEmpty),!1)},we=function(e){ve(!1),a.utilities.showError(t,"".concat(e," ").concat(Pe[s].errorServer),!1)},Le=function(e,n,r){ve(!1);var i="".concat(e," ").concat(Pe[s].errorProj," ").concat(n,", ").concat(Pe[s].only," ").concat(r.join(", "));a.utilities.showError(t,i,!1)},Oe=function(){var e=(0,g.A)(x().mark((function e(){var n,r,i,o,s,l,c,u,p,d,f,v;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.projection.projections[a.maps[t].getMapState().currentProjection].getCode(),r=[],e.prev=2,o=z.split("?"),s=(0,h.A)(o,2),l=s[0],c=s[1],u=new URLSearchParams(c),p=(null===(i=u.get("layers"))||void 0===i?void 0:i.split(","))||[""],e.next=8,a.geoUtilities.getWMSServiceMetadata(l,"");case 8:if(d=e.sent,(r=d.Capability.Layer.CRS).includes(n)){e.next=12;break}throw new Error("proj");case 12:f=[],v=function e(t){if(t.Layer&&t.Layer.length>0)t.Layer.forEach((function(t){e(t)}));else for(var n=0;n<p.length;n++)t.Name===p[n]&&f.push([t.Name,t.Title])},d.Capability.Layer&&v(d.Capability.Layer),1===f.length?(se(f[0][1]),pe([{layerId:f[0][0]}])):re(f),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(2),"proj"===e.t0.message?Le("WMS",n,r):we("WMS"),e.abrupt("return",!1);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,null,[[2,18]])})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=(0,g.A)(x().mark((function e(){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.geoUtilities.getWFSServiceMetadata(z);case 3:t=e.sent,1===(n=t.FeatureTypeList.FeatureType.map((function(e){return[e.Name["#text"].split(":")[1],e.Title["#text"]]}))).length?(se(n[0][1]),pe([{layerId:n[0][0]}])):re(n),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),we("WFS"),e.abrupt("return",!1);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=(0,g.A)(x().mark((function e(){var t,n,r,a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["id","title"],e.next=3,fetch("".concat(z,"/?f=json"));case 3:if(200===(n=e.sent).status){e.next=7;break}return we("OGC API Feature"),e.abrupt("return",!1);case 7:return e.next=9,n.json();case 9:if(r=e.sent,!t.every((function(e){return Object.keys(r).includes(e)}))){e.next=15;break}return pe([{layerId:r.id}]),se(r.title),e.abrupt("return",!0);case 15:return e.prev=15,a=["collections","links"],e.next=19,fetch("".concat(z,"/collections?f=json"));case 19:return i=e.sent,e.next=22,i.json();case 22:if(o=e.sent,a.every((function(e){return Object.keys(o).includes(e)}))){e.next=26;break}throw new Error("err");case 26:1===(s=o.collections.map((function(e){return[e.id,e.title]}))).length?(se(s[0][1]),pe([{layerId:s[0][0]}])):re(s),e.next=34;break;case 30:return e.prev=30,e.t0=e.catch(15),we("OGC API Feature"),e.abrupt("return",!1);case 34:return e.abrupt("return",!0);case 35:case"end":return e.stop()}}),e,null,[[15,30]])})));return function(){return e.apply(this,arguments)}}(),Ne=function(){try{if(!(-1===z.indexOf("/")&&32===z.replaceAll("-","").length))throw new Error("err");se(""),pe([{layerId:z}])}catch(e){return we("GeoCore UUID"),!1}return!0},Te=function(){var e=(0,g.A)(x().mark((function e(t){var n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.geoUtilities.getESRIServiceMetadata(z);case 3:if(!(n=e.sent).capabilities.includes(Ie(t).capability)){e.next=8;break}"layers"in n?1===(r=n.layers.map((function(e){return[e.id,e.name]}))).length?(se(r[0][1]),pe([{layerId:r[0][0]}])):re(r):(se(n.name),pe([{layerId:n.id}])),e.next=9;break;case 8:throw new Error("err");case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),we(Ie(t).err),e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),De=function(){for(var e=["{x}","{y}","{z}"],t=0;t<e.length;t+=1)if(!z.includes(e[t]))return we("XYZ Tile"),!1;var n=z;return se(""),pe([{layerId:z,source:{dataAccessPath:{en:n,fr:n}}}]),!0},Re=function(){var e=(0,g.A)(x().mark((function e(){var t,n,r,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(z);case 3:return t=e.sent,e.next=6,t.json();case 6:if(n=e.sent,["FeatureCollection","Feature"].includes(n.type)){e.next=9;break}throw new Error("err");case 9:r=z.split("/").pop(),a=z.replace(r,""),oe||se(r),pe([{layerId:r,source:{dataAccessPath:{en:a,fr:a}}}]),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),we("GeoJSON"),e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,g.A)(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ve(!0),t=!0,void 0!==Q){e.next=8;break}t=!1,ve(!1),Ce(Pe[s].service),e.next=49;break;case 8:if(Q!==f){e.next=14;break}return e.next=11,Oe();case 11:t=e.sent,e.next=49;break;case 14:if(Q!==y){e.next=20;break}return e.next=17,Se();case 17:t=e.sent,e.next=49;break;case 20:if(Q!==b){e.next=26;break}return e.next=23,ke();case 23:t=e.sent,e.next=49;break;case 26:if(Q!==j){e.next=30;break}t=De(),e.next=49;break;case 30:if(Q!==c){e.next=36;break}return e.next=33,Te(c);case 33:t=e.sent,e.next=49;break;case 36:if(Q!==u){e.next=42;break}return e.next=39,Te(u);case 39:t=e.sent,e.next=49;break;case 42:if(Q!==p){e.next=48;break}return e.next=45,Re();case 45:t=e.sent,e.next=49;break;case 48:Q===d?(n=void 0,r=void 0,n=z.split("/").pop(),r=z.replace(n,""),oe||se(n),pe([{layerId:n,source:{dataAccessPath:{en:r,fr:r}}}]),t=!0):Q===E&&(t=Ne());case 49:t&&(ve(!1),B(2));case 50:case"end":return e.stop()}var n,r}),e)})));return function(){return e.apply(this,arguments)}}(),Fe=function(){ve(!0);var e=a.generateId();a.event.on(a.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){v.vF.logTraceCoreAPIEvent("LAYER-STEPPER - EVENT_LAYER_ADDED"),a.event.off(a.eventNames.LAYER.EVENT_LAYER_ADDED,t),ve(!1),n(!1)}),"".concat(t,"/").concat(e));var r=!0,i=oe,o=z;if(Q!==c&&Q!==u||(o=a.geoUtilities.getMapServerUrl(z)),Q===f){var l=z.split("?");o=(0,h.A)(l,1)[0]}""===oe&&(r=!1,Ce(je()?Pe[s].layer:Pe[s].name));var g={geoviewLayerId:e,geoviewLayerName:{en:i,fr:i},geoviewLayerType:Q,metadataAccessPath:{en:o,fr:o},listOfLayerEntryConfig:ue};Q!==p&&Q!==j&&Q!==d||(g.metadataAccessPath={en:"",fr:""}),Q===E&&delete g.metadataAccessPath,Q===b&&(g.metadataAccessPath={en:a.geoUtilities.getOGCServerUrl(z),fr:a.geoUtilities.getOGCServerUrl(z)}),r&&(Q===E&&setTimeout((function(){ve(!1),n(!1)}),3e3),g.geoviewLayerId?a.maps[t].layer.layerOrder.push(g.geoviewLayerId):void 0!==g.listOfLayerEntryConfig&&g.listOfLayerEntryConfig.forEach((function(e){e.layerId&&a.maps[t].layer.layerOrder.unshift(e.layerId)})),a.maps[t].layer.addGeoviewLayer(g))},Ge=function(){B((function(e){return e-1}))},Me=function(e){var t=URL.createObjectURL(e);Z(e.name),Y(t);var n=e.name.split(".")[0];$(""),re([]),se(n),pe([])},We=function(e){se(e.target.value)},Be=function(e){var n;if(e.preventDefault(),e.stopPropagation(),me(!1),null!==(n=e.dataTransfer)&&void 0!==n&&n.files){var r=e.dataTransfer.files[0],i=r.name.toUpperCase();i.endsWith(".JSON")||i.endsWith(".GEOJSON")||i.endsWith(".GPKG")||i.endsWith(".CSV")?Me(r):a.utilities.showError(t,Pe[s].errorFile,!1)}};function _e(e){var t=e.isFirst,n=void 0!==t&&t,r=e.isLast,a=void 0!==r&&r,i=e.handleNext;return he?(0,m.jsx)(D,{sx:{padding:10},children:(0,m.jsx)(T,{})}):(0,m.jsxs)(k,{sx:Ae.buttonGroup,children:[(0,m.jsx)(S,{variant:"contained",type:"text",onClick:i,children:a?Pe[s].finish:Pe[s].continue}),!n&&(0,m.jsx)(S,{variant:"contained",type:"text",onClick:Ge,children:Pe[s].back})]})}return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(D,{sx:{display:"flex",justifyContent:"end",zIndex:2},children:(0,m.jsx)(R,{color:"primary",onClick:function(){return n(!1)},children:(0,m.jsx)(U,{})})}),(0,m.jsx)(L,{sx:{position:"relative",top:"-30px",zIndex:1},activeStep:W,orientation:"vertical",steps:[{stepLabel:{children:Pe[s].stepOne},stepContent:{children:(0,m.jsxs)("div",{className:"dropzone",style:{position:"relative"},onDrop:function(e){return Be(e)},onDragOver:function(e){return(t=e).preventDefault(),void t.stopPropagation();var t},onDragEnter:function(e){return(t=e).preventDefault(),t.stopPropagation(),void(t.target!==be.current&&me(!0));var t},onDragLeave:function(e){return(t=e).preventDefault(),t.stopPropagation(),void(t.target===be.current&&me(!1));var t},children:[xe&&(0,m.jsx)("div",{ref:be,style:{backgroundColor:"rgba(128,128,128,.95)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999,textAlign:"center",color:"black",fontSize:24},children:(0,m.jsxs)("h3",{children:[(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),Pe[s].dropzone]})}),(0,m.jsx)("div",{children:(0,m.jsx)("input",{type:"file",id:"fileUpload",style:{display:"none"},onChange:function(e){e.target.files&&Me(e.target.files[0])},accept:".gpkg, .json, .geojson, .csv"})}),(0,m.jsxs)(S,{type:"text",onClick:function(){var e;return null===(e=document.getElementById("fileUpload"))||void 0===e?void 0:e.click()},className:"",children:[(0,m.jsx)(F,{}),(0,m.jsx)("span",{children:Pe[s].upload})]}),(0,m.jsx)("p",{style:{textAlign:"center"},children:(0,m.jsx)("small",{children:Pe[s].drop})}),(0,m.jsx)("p",{style:{textAlign:"center"},children:Pe[s].or}),(0,m.jsx)(O,{sx:{width:"100%"},label:Pe[s].url,variant:"standard",value:X,onChange:function(e){Z(e.target.value.trim()),Y(e.target.value.trim()),$(""),re([]),se(""),pe([])},multiline:!0}),(0,m.jsx)("br",{}),(0,m.jsx)(_e,{isFirst:!0,handleNext:function(){var e,n,r=!0;""===z.trim()&&(r=!1,ve(!1),a.utilities.showError(t,Pe[s].errorNone,!1)),r&&(e=X.toUpperCase().split("/"),n=parseInt(e[e.length-1],10),X.toUpperCase().endsWith("MAPSERVER")||X.toUpperCase().endsWith("MAPSERVER/")?$(c):-1!==X.toUpperCase().indexOf("FEATURESERVER")||-1!==X.toUpperCase().indexOf("MAPSERVER")&&!Number.isNaN(n)?$(u):-1!==e.indexOf("WFS")?$(y):X.toUpperCase().endsWith(".JSON")||X.toUpperCase().endsWith(".GEOJSON")?$(p):X.toUpperCase().endsWith(".GPKG")?$(d):-1!==X.toUpperCase().indexOf("{Z}/{X}/{Y}")||-1!==X.toUpperCase().indexOf("{Z}/{Y}/{X}")?$(j):-1===X.indexOf("/")&&32===X.replaceAll("-","").length?$(E):-1!==X.toUpperCase().indexOf("WMS")&&$(f),B(1))}})]})}},{stepLabel:{children:Pe[s].stepTwo},stepContent:{children:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(w,{fullWidth:!0,labelId:"service-type-label",value:Q,onChange:function(e){$(e.target.value),re([]),pe([])},label:Pe[s].service,inputLabel:{id:"service-type-label"},menuItems:Ee.map((function(e){var t=(0,h.A)(e,2),n=t[0];return{key:n,item:{value:n,children:t[1]}}})),variant:"standard"}),(0,m.jsx)(_e,{handleNext:Ue})]})}},{stepLabel:{children:Pe[s].stepThree},stepContent:{children:(0,m.jsxs)(m.Fragment,{children:[0===ne.length&&(0,m.jsx)(O,{label:Pe[s].name,variant:"standard",value:oe,onChange:We}),ne.length>1&&(0,m.jsx)(N,{fullWidth:!0,multiple:je(),disableClearable:!je(),id:"service-layer-label",options:ne,getOptionLabel:function(e){return"".concat(e[1]," (").concat(e[0],")")},renderOption:function(e,t){return(0,m.jsx)("span",A(A({},e),{},{children:t[1]}))},onChange:function(e,t){je()?(pe(t.map((function(e){return{layerId:"".concat(e[0])}}))),se(t.map((function(e){return e[1]})).join(", "))):(pe([{layerId:"".concat(t[0])}]),se(t[1]))},renderInput:function(e){return(0,m.jsx)(O,A(A({},e),{},{label:Pe[s].layerSelect}))}}),(0,m.jsx)("br",{}),(0,m.jsx)(_e,{isLast:!je(),handleNext:je()?function(){var e=!0;0===ue.length&&(e=!1,Ce(Pe[s].layer)),e&&B(3)}:Fe})]})}},je()?{stepLabel:{children:Pe[s].stepFour},stepContent:{children:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(O,{sx:{width:"100%"},label:Pe[s].name,variant:"standard",value:oe,onChange:We}),(0,m.jsx)("br",{}),(0,m.jsx)(_e,{isLast:!0,handleNext:Fe})]})}}:null]})]})};var E=n(93987);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,c.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const C=function(e){var t=e.mapId,n=e.title,r=e.layerIds,a=e.setReorderLayersVisible,i=e.setMapLayers,o=window.cgpv,s=o.api,l=o.ui.elements,c=l.List,u=l.ListItem,p=l.ListItemButton,d=l.ListItemIcon,v=l.HandleIcon,g=l.ListItemText,y=l.Box,x=l.IconButton,b=l.CloseIcon,A=s.maps[t].displayLanguage,j={titleBar:{position:"relative",top:"-30px",zIndex:1},draggableList:{top:"-30px"},regularListItem:{color:"text.primary",padding:0},draggingListItem:{color:"text.primary",padding:0,background:"rgb(235,235,235,0.5)"},listItemText:{fontSize:14,noWrap:!0},handleIcon:{margin:"8px 0px"}},P=function(e){return s.maps[t].layer.geoviewLayers[e].geoviewLayerName[A]};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(y,{sx:{display:"flex",justifyContent:"end",zIndex:2},children:(0,m.jsx)(x,{className:"style3",onClick:function(){return a(!1)},children:(0,m.jsx)(b,{})})}),(0,m.jsx)(y,{sx:j.titleBar,children:n}),(0,m.jsx)(E.JY,{onDragEnd:function(e){var n=e.destination,a=e.source;if(n){var o=(0,f.A)(r),l=o.splice(a.index,1),c=(0,h.A)(l,1)[0];o.splice(n.index,0,c),s.maps[t].layer.moveLayer(c,n.index),i(o)}},children:(0,m.jsx)(E.gL,{droppableId:"droppable",children:function(e){return(0,m.jsxs)(c,I(I({sx:j.draggableList},e.droppableProps),{},{innerref:e.innerRef,children:[r.map((function(e,t){return(0,m.jsx)(E.sx,{draggableId:e,index:t,children:function(t,n){return(0,m.jsx)(u,I(I(I({innerref:t.innerRef,sx:n.isDragging?j.draggingListItem:j.regularListItem},t.draggableProps),t.dragHandleProps),{},{children:(0,m.jsxs)(p,{children:[(0,m.jsx)(d,{children:(0,m.jsx)(v,{sx:j.handleIcon})}),(0,m.jsx)(g,{primaryTypographyProps:j.listItemText,primary:P(e)})]})}))}},e)})),e.placeholder]}))}})})]})};const w=function(e){var t=e.mapId,n=e.buttonPanel,r=window.cgpv,a=r.api,i=r.ui,o=r.react,s=o.useState,l=o.useEffect,c=s(!1),p=(0,h.A)(c,2),d=p[0],g=p[1],y=s(!1),x=(0,h.A)(y,2),b=x[0],A=x[1],E=s([]),P=(0,h.A)(E,2),I=P[0],w=P[1],L=s(),O=(0,h.A)(L,2),S=O[0],k=O[1],N=s(null),T=(0,h.A)(N,2),D=T[0],R=T[1],U=s(!1),F=(0,h.A)(U,2),G=F[0],M=F[1],W=s(!1),B=(0,h.A)(W,2),_=B[0],V=B[1],z=i.elements,Y=z.IconButton,J=z.AddIcon,K=z.Box,X=z.ExpandMoreIcon,Z=z.ExpandLessIcon,H=z.VisibilityIcon,q=z.VisibilityOffIcon,Q=z.Menu,$=z.MenuItem,ee=z.MenuIcon,te=z.ListItemIcon,ne=z.ListItemText,re=z.ReorderIcon,ae=a.maps[t].getDisplayLanguage(),ie=(0,u.NK)({en:{addLayer:"Add Layer",expandAll:"Expand Groups",collapseAll:"Collapse Groups",showAll:"Show All",hideAll:"Hide All",reorderLayers:"Reorder Layers"},fr:{addLayer:"Ajouter Couche",expandAll:"Élargir les groupes",collapseAll:"Réduire les groupes",showAll:"Montrer tout",hideAll:"Cacher tout",reorderLayers:"Réorganiser les couches"}}),oe={mainContainer:{display:"flex",flexDirection:"column",height:"inherit"},topControls:{display:"flex",flexDirection:"row",justifyContent:"space-between"},addLayerSection:{display:"flex",alignItems:"center",marginTop:"auto",justifyContent:"end"}},se=Boolean(D),le=function(){var e;v.vF.logTraceCoreAPIEvent("PANEL-CONTENT - updateLayers"),void 0!==(null===(e=a.maps[t].layer)||void 0===e?void 0:e.layerOrder)&&w((0,f.A)(a.maps[t].layer.layerOrder).reverse())};l((function(){return v.vF.logTraceUseEffect("PANEL-CONTENT - mount 1"),a.event.on(a.eventNames.MAP.EVENT_MAP_LOADED,le,t),a.event.on(a.eventNames.GET_LEGENDS.LEGEND_LAYERSET_UPDATED,le,"".concat(t,"/LegendsLayerSet")),function(){a.event.off(a.eventNames.MAP.EVENT_MAP_LOADED,t,le),a.event.off(a.eventNames.GET_LEGENDS.LEGEND_LAYERSET_UPDATED,t,le)}}),[]),l((function(){}),[I]),l((function(){v.vF.logTraceUseEffect("PANEL-CONTENT - mount 2");var e=function(){v.vF.logTraceCoreAPIEvent("PANEL-CONTENT - setAddLayerVisibleListenerFunction"),g(!1)};return a.event.on(a.eventNames.PANEL.EVENT_PANEL_CLOSE,e,"".concat(t,"/").concat(n.buttonPanelId)),function(){a.event.off(a.eventNames.PANEL.EVENT_PANEL_CLOSE,"".concat(t,"/").concat(n.buttonPanelId),e)}}),[a,n.buttonPanelId,t]),l((function(){k(null)}),[G]),l((function(){k(null)}),[_]);var ce=function(){R(null)},ue=function(e){M(e),ce()},pe=function(e){V(!e),ce()};return l((function(){if(b){var e=window.scrollX,t=window.scrollY;window.onscroll=function(){window.scrollTo(e,t)}}else window.onscroll=function(){}}),[b]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(Q,{anchorEl:D,open:se,onClose:ce,children:[(0,m.jsxs)($,{onClick:function(){return ue(!0)},children:[(0,m.jsx)(te,{children:(0,m.jsx)(X,{})}),(0,m.jsx)(ne,{children:ie[ae].expandAll})]}),(0,m.jsxs)($,{onClick:function(){return ue(!1)},children:[(0,m.jsx)(te,{children:(0,m.jsx)(Z,{})}),(0,m.jsx)(ne,{children:ie[ae].collapseAll})]}),(0,m.jsxs)($,{onClick:function(){return pe(!0)},children:[(0,m.jsx)(te,{children:(0,m.jsx)(H,{})}),(0,m.jsx)(ne,{children:ie[ae].showAll})]}),(0,m.jsxs)($,{onClick:function(){return pe(!1)},children:[(0,m.jsx)(te,{children:(0,m.jsx)(q,{})}),(0,m.jsx)(ne,{children:ie[ae].hideAll})]}),(0,m.jsxs)($,{onClick:function(){return A(!0),void ce()},children:[(0,m.jsx)(te,{children:(0,m.jsx)(re,{})}),(0,m.jsx)(ne,{children:ie[ae].reorderLayers})]})]}),(0,m.jsxs)(K,{sx:oe.mainContainer,children:[d&&(0,m.jsx)(j,{mapId:t,setAddLayerVisible:g}),b&&(0,m.jsx)(C,{mapId:t,title:ie[ae].reorderLayers,layerIds:I,setMapLayers:w,setReorderLayersVisible:A}),(0,m.jsxs)(K,{sx:oe.topControls,style:{display:d||b?"none":"flex"},children:[(0,m.jsx)("div",{children:(0,m.jsx)(Y,{color:"primary",onClick:function(e){R(e.currentTarget)},children:(0,m.jsx)(ee,{})})}),(0,m.jsxs)(K,{onClick:function(){g((function(e){return!e}))},children:[ie[ae].addLayer,(0,m.jsx)(Y,{children:(0,m.jsx)(J,{})})]})]}),(0,m.jsx)("div",{style:{display:d||b?"none":"block"},children:S})]})]})},L=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Layers/Legend Config Schema","type":"object","version":1,"comments":"Configuration for GeoView layers package.","additionalProperties":false,"properties":{"reorderable":{"type":"boolean","default":true,"description":"Specifies if the items in the legend can be reordered."},"allowImport":{"type":"boolean","default":true,"description":"Specifies if the user-added layers are allowed."},"isOpen":{"type":"object","description":"Specifies whether the legend is opened by default on initial loading of the map for small, medium, and large viewports.","properties":{"large":{"type":"boolean","default":false,"description":"Whether the legend is opened by default on initial loading of the map for large viewports."},"medium":{"type":"boolean","default":false,"description":"Whether the legend is opened by default on initial loading of the map for medium viewports."},"small":{"type":"boolean","default":false,"description":"Whether the legend is opened by default on initial loading of the map for small viewports."}},"additionalProperties":false},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1},"version":{"type":"string","enum":["1.0"],"description":"The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."}},"required":["suportedLanguages"]}'),O=JSON.parse('{"reorderable":true,"allowImport":true,"isOpen":{"small":false,"medium":false,"large":false},"suportedLanguages":["en","fr"]}');function S(e,t,n){return t=(0,o.A)(t),(0,i.A)(e,k()?Reflect.construct(t,n||[],(0,o.A)(e).constructor):t.apply(e,n))}function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(k=function(){return!!e})()}var N=function(e){function t(){var e;(0,r.A)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e=S(this,t,[].concat(a)),(0,c.A)((0,s.A)(e),"schema",(function(){return L})),(0,c.A)((0,s.A)(e),"defaultConfig",(function(){return(0,u.NK)(O)})),(0,c.A)((0,s.A)(e),"translations",(0,u.NK)({en:{layersPanel:{title:"Layers"}},fr:{layersPanel:{title:"Couches"}}})),e}return(0,l.A)(t,e),(0,a.A)(t,[{key:"onCreateButtonProps",value:function(){return{id:"layersPanelButton",tooltip:"layersPanel.title",tooltipPlacement:"right",children:(0,m.jsx)(d.LayersOutlinedIcon,{}),visible:!0}}},{key:"onCreateContentProps",value:function(){var e;return{title:"layersPanel.title",icon:(0,m.jsx)(d.LayersOutlinedIcon,{}),width:350,status:null===(e=this.configObj)||void 0===e||null===(e=e.isOpen)||void 0===e?void 0:e.large}}},{key:"onCreateContent",value:function(){return(0,m.jsx)(w,{buttonPanel:this.buttonPanel,mapId:this.pluginProps.mapId})}}]),t}(p.i);window.geoviewPlugins=window.geoviewPlugins||{},window.geoviewPlugins["layers-panel"]=(0,u.KX)(N)}},e=>{var t;t=97617,e(e.s=t)}]);
//# sourceMappingURL=geoview-layers-panel.js.map