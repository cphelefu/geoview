/*! Package:geoview-footer-panel: 0.1.0 - "5236266a957db4e62cfee3c10fd104c61f934abf" - 2023-10-27T06:11:44.269Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[435],{47767:(e,t,n)=>{var a=n(52908),r=n(42037),o=n(63684),i=n(98512),s=n(57694),u=n(30452),c=n(89568),l=n(65621);const f=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Footer Config Schema","type":"object","version":1,"comments":"Configuration for GeoView footer package.","additionalProperties":true,"properties":{"tabs":{"type":"object","description":"Available tabs","properties":{"defaultTabs":{"type":"array","items":{"type":"string","enum":["legend","layers","details","data-table"]},"minItems":0,"default":["legend","layers","details","data-table"],"uniqueItems":true,"description":"Defaut tabs of footer panel to use"},"customTabs":{"type":"array","items":{"type":"object","properties":{"defaultTabs":{"type":"string"},"contentHTML":{"type":"string"}}},"minItems":0,"default":[],"uniqueItems":true,"description":"Custom tabs of footer panel to use"}},"additionalProperties":false},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1},"version":{"type":"string","enum":["1.0"],"description":"The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."},"collapsed":{"type":"boolean","default":true,"description":"State of footer panel when map is loaded"}},"required":["suportedLanguages","tabs"]}'),v=JSON.parse('{"tabs":{"defaultTabs":["legend","layers","details","data-table"],"customTabs":[]},"suportedLanguages":["en","fr"]}');var d=n(59195),E=n(29541),p=window;function m(e){var t=e.mapId,n=p.cgpv,a=n.api,r=n.react,o=r.useState,i=r.useEffect,s=o([]),u=(0,d.Z)(s,2),c=u[0],f=u[1],v=o(),m=(0,d.Z)(v,2),g=m[0],y=m[1],L=o([]),A=(0,d.Z)(L,2),_=A[0],N=A[1],T=o(null),b=(0,d.Z)(T,2),h=b[0],D=b[1],R=function(e){if((0,l.gNW)(e)&&"at_long_lat"===e.queryType){var n=e.resultSets,r=[];Object.keys(n).forEach((function(e){var o,i=(0,l.dIw)(a.maps[t].layer.registeredLayers[e].layerName,t),s=null===(o=n[e])||void 0===o?void 0:o.data.at_long_lat;null!=s&&s.length&&(null==s?void 0:s.length)>0&&r.push({layerPath:e,layerName:i,features:s})})),r.length>0?f(r):f([])}else f([])},I=function(e){if((0,l.gux)(e)){var t=e.coordinates;D(e.handlerName),N(t.lnglat)}else N([])};return i((function(){return a.event.on(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,R,"".concat(t,"/FeatureInfoLayerSet")),a.event.on(a.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,I,t),function(){a.event.off(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,t,R),a.event.off(a.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,t,I)}}),[]),i((function(){y(a.maps[t].details.createDetails(t,c,{mapId:t,location:_,handlerName:h}))}),[c,_]),(0,E.jsx)("div",{children:g})}var g=n(27909),y=window;function L(e){var t=e.mapId,n=y.cgpv,a=n.api,r=n.react,o=r.useState,i=r.useEffect,s=o(),u=(0,d.Z)(s,2),c=u[0],f=u[1],v=o([]),p=(0,d.Z)(v,2),m=p[0],L=p[1],A=function(){var e;void 0!==(null===(e=a.maps[t].layer)||void 0===e?void 0:e.layerOrder)&&L((0,g.Z)(a.maps[t].layer.layerOrder).reverse())},_=function(){return A()},N=function(e){(0,l.UKz)(e)&&L((function(t){return t.filter((function(t){return t!==e.geoviewLayer.geoviewLayerId}))}))},T=function(e){(0,l.riW)(e)&&a.event.on(a.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){A(),a.event.off(a.eventNames.LAYER.EVENT_LAYER_ADDED,"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))}),"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))};return i((function(){return a.event.on(a.eventNames.MAP.EVENT_MAP_LOADED,_,t),a.event.on(a.eventNames.LAYER.EVENT_REMOVE_LAYER,N,t),a.event.on(a.eventNames.LAYER.EVENT_ADD_LAYER,T,t),function(){a.event.off(a.eventNames.MAP.EVENT_MAP_LOADED,t,_),a.event.off(a.eventNames.LAYER.EVENT_REMOVE_LAYER,t,N),a.event.off(a.eventNames.LAYER.EVENT_ADD_LAYER,t,T)}}),[]),i((function(){f(a.maps[t].legend.createLegend({layerIds:m,isRemoveable:!1,canSetOpacity:!0,canZoomTo:!0}))}),[m]),(0,E.jsx)("div",{children:c})}var A=n(67016),_=n(91241),N=n.n(_),T=window;function b(e){var t=e.mapId,n=T.cgpv,a=n.api,r=n.react,o=r.useState,i=r.useEffect,s=o(null),u=(0,d.Z)(s,2),c=u[0],l=u[1],f=function(){var e=(0,A.Z)(N().mark((function e(){var a;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.api.maps[t].dataTable.createDataPanel();case 2:a=e.sent,l(a);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){setTimeout((function(){f()}),1e3)};return i((function(){return a.event.on(a.eventNames.MAP.EVENT_MAP_LOADED,v,t),function(){a.event.off(a.eventNames.MAP.EVENT_MAP_LOADED,t,v)}}),[]),(0,E.jsx)("div",{children:c})}var h=window;function D(e){var t=e.mapId,n=h.cgpv,a=n.api,r=n.react,o=r.useState,i=r.useEffect,s=o(),u=(0,d.Z)(s,2),c=u[0],f=u[1],v=o([]),p=(0,d.Z)(v,2),m=p[0],y=p[1],L=function(){var e;void 0!==(null===(e=a.maps[t].layer)||void 0===e?void 0:e.layerOrder)&&y((0,g.Z)(a.maps[t].layer.layerOrder).reverse())},A=function(){return L()},_=function(e){(0,l.UKz)(e)&&y((function(t){return t.filter((function(t){return t!==e.geoviewLayer.geoviewLayerId}))}))},N=function(e){(0,l.riW)(e)&&a.event.on(a.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){L(),a.event.off(a.eventNames.LAYER.EVENT_LAYER_ADDED,"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))}),"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))};return i((function(){return a.event.on(a.eventNames.MAP.EVENT_MAP_LOADED,A,t),a.event.on(a.eventNames.LAYER.EVENT_REMOVE_LAYER,_,t),a.event.on(a.eventNames.LAYER.EVENT_ADD_LAYER,N,t),function(){a.event.off(a.eventNames.MAP.EVENT_MAP_LOADED,t,A),a.event.off(a.eventNames.LAYER.EVENT_REMOVE_LAYER,t,_),a.event.off(a.eventNames.LAYER.EVENT_ADD_LAYER,t,N)}}),[]),i((function(){f(a.maps[t].layers.createLayers({layerIds:m,isRemoveable:!1,canSetOpacity:!0,canZoomTo:!0}))}),[m]),(0,E.jsx)("div",{children:c})}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,s.Z)(this,n)}}var I=window,Z=function(e){(0,i.Z)(n,e);var t=R(n);function n(e,r){var i;return(0,a.Z)(this,n),i=t.call(this,e,r),(0,c.Z)((0,o.Z)(i),"schema",(function(){return f})),(0,c.Z)((0,o.Z)(i),"defaultConfig",(function(){return(0,l.ZQJ)(v)})),(0,c.Z)((0,o.Z)(i),"translations",(0,l.ZQJ)({en:{legend:"Legend",layers:"Layers",details:"Details",dataTable:"DataTable"},fr:{legend:"Légende",layers:"Couches",details:"Détails",dataTable:"Données"}})),(0,c.Z)((0,o.Z)(i),"added",(function(){var e=(0,o.Z)(i),t=e.configObj,n=e.pluginProps.mapId,a=I.cgpv;if(a){var r=a.api,s=r.maps[n],u=s.displayLanguage,c=s.footerTabs,f=null==t?void 0:t.tabs.defaultTabs,v=0;if(f.includes("legend")&&(c.createFooterTab({value:v,label:i.translations[u].legend,content:function(){return(0,E.jsx)(L,{mapId:n})}}),v++),console.log("defaultTabs ",f),f.includes("layers")&&(c.createFooterTab({value:v,label:i.translations[u].layers,content:function(){return(0,E.jsx)(D,{mapId:n})}}),v++),f.includes("details")){var d=v;c.createFooterTab({value:d,label:i.translations[u].details,content:function(){return(0,E.jsx)(m,{mapId:n})}}),v++,r.event.on(r.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,(function(e){if((0,l.gNW)(e)){var t=e.resultSets,n=[];Object.keys(t).forEach((function(e){n=n.concat(t[e])})),n.length>0&&c.selectFooterTab(d)}}),"".concat(n,"/FeatureInfoLayerSet"))}f.includes("data-table")&&(c.createFooterTab({value:v,label:i.translations[u].dataTable,content:function(){return(0,E.jsx)(b,{mapId:n})}}),v++);for(var p=null==t?void 0:t.tabs.customTabs,g=0;g<p.length;g++){var y=p[g];c.createFooterTab({value:v,label:y.title,content:y.contentHTML}),v++}}})),i.buttonPanel=null,i}return(0,r.Z)(n,[{key:"removed",value:function(){I.cgpv}}]),n}(l.Vw$);I.plugins=I.plugins||{},I.plugins["footer-panel"]=(0,l.RFZ)(Z)}},e=>{var t;t=47767,e(e.s=t)}]);
//# sourceMappingURL=geoview-footer-panel.js.map